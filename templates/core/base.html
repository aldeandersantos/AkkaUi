{% load static %}
{% load i18n %}
<!doctype html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}AkkaUi{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'core/design-system.css' %}">
    <link rel="stylesheet" href="{% static 'core/wiki.css' %}">
    <link rel="stylesheet" href="{% static 'core/ui-enhancements.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'Favicon.ico' %}">
    
    <!-- HTMX para intera√ß√µes din√¢micas sem JavaScript complexo -->
    <script src="https://unpkg.com/htmx.org@1.9.10" 
            integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" 
            crossorigin="anonymous"></script>
    
  <!-- Alpine.js para reatividade leve (modais, toggles) -->
  <!-- Removido 'integrity' e 'crossorigin' porque hashes incorretos podem bloquear o carregamento em alguns ambientes; manter 'defer' -->
  <script defer src="https://unpkg.com/alpinejs@3.13.5/dist/cdn.min.js"></script>
    <!-- Oculta elementos com x-cloak at√© o Alpine inicializar -->
    <style>[x-cloak]{display:none!important;}</style>
    <!-- HTMX + CSRF: garante que requisi√ß√µes HTMX enviem o header X-CSRFToken usando o cookie csrftoken -->
    <script>
      function getCookie(name) {
        const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
        return v ? v.pop() : '';
      }
      document.body.addEventListener('htmx:configRequest', function(evt) {
        const token = getCookie('csrftoken');
        if (token) {
          evt.detail.headers['X-CSRFToken'] = token;
        }
      });
    </script>
    
    {% block extra_head %}{% endblock %}
  </head>
  <body>
    <!-- Notification Toast Container -->
    <div id="notificationContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 0.5rem;"></div>
    
    <header class="site-header-dark" style="position: relative; z-index: 100;">
      <div class="container">
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
          <!-- Logo e Navega√ß√£o Desktop -->
          <div style="display: flex; align-items: center; gap: 2rem;">
            <a href="{% url 'core:home' %}" class="brand">
              <span class="brand-icon">A</span>
              <span>AkkaUi</span>
            </a>
            
            <!-- Desktop Navigation - sempre vis√≠vel em telas grandes -->
            <nav style="display: none; gap: 1.5rem; align-items: center;" id="desktopNav">
              <a href="{% url 'core:explore' %}" style="color: var(--text-gray-300); text-decoration: none; transition: var(--transition-fast); font-size: 0.9375rem;" onmouseover="this.style.color='var(--text-white)'" onmouseout="this.style.color='var(--text-gray-300)'">{% trans "Explore" %}</a>
              <a href="{% url 'core:pricing' %}" style="color: var(--text-gray-300); text-decoration: none; transition: var(--transition-fast); font-size: 0.9375rem;" onmouseover="this.style.color='var(--text-white)'" onmouseout="this.style.color='var(--text-gray-300)'">{% trans "Pricing" %}</a>
              <a href="{% url 'core:faq' %}" style="color: var(--text-gray-300); text-decoration: none; transition: var(--transition-fast); font-size: 0.9375rem;" onmouseover="this.style.color='var(--text-white)'" onmouseout="this.style.color='var(--text-gray-300)'">FAQ</a>
              {% if user.is_authenticated %}
                <a href="{% url 'core:minha_biblioteca' %}" style="color: var(--text-gray-300); text-decoration: none; transition: var(--transition-fast); font-size: 0.9375rem;" onmouseover="this.style.color='var(--text-white)'" onmouseout="this.style.color='var(--text-gray-300)'">{% trans "Library" %}</a>
                <a href="{% url 'usuario:favoritos' %}" style="color: var(--text-gray-300); text-decoration: none; transition: var(--transition-fast); font-size: 0.9375rem;" onmouseover="this.style.color='var(--text-white)'" onmouseout="this.style.color='var(--text-gray-300)'">‚ù§Ô∏è Favoritos</a>
              {% endif %}
              {% if user.is_authenticated and user.admin %}
                <a href="{% url 'core:admin_svg' %}" style="color: var(--text-gray-300); text-decoration: none; transition: var(--transition-fast); font-size: 0.9375rem;" onmouseover="this.style.color='var(--text-white)'" onmouseout="this.style.color='var(--text-gray-300)'">{% trans "Admin" %}</a>
              {% endif %}
            </nav>
          </div>
          
          <!-- Actions - direita -->
          <div class="actions">
            <button class="icon-button" onclick="toggleSearch(event)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </button>
            
            {% if user.is_authenticated %}
              <a href="{% url 'core:cart' %}" class="icon-button" style="position: relative; text-decoration: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
              </a>
            {% endif %}
            
            {% if user.is_authenticated %}
              <!-- Avatar simples sem dropdown -->
              <a href="{% url 'usuario:profile' %}" class="icon-button" style="width: 2rem; height: 2rem; background-color: var(--primary); border-radius: 50%; color: var(--bg-black); font-weight: 600; font-size: 0.875rem; display: flex; align-items: center; justify-content: center; text-decoration: none;" title="{% trans 'Profile' %}">
                {{ user.username|slice:":1"|upper }}
              </a>
            {% else %}
              <a href="{% url 'usuario:signin' %}" class="btn btn-outline" style="padding: 0.5rem 1rem; font-size: 0.875rem; height: auto; display: none;" id="signinBtn">{% trans "Sign In" %}</a>
              <a href="{% url 'usuario:signup' %}" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem; height: auto; display: none;" id="signupBtn">{% trans "Sign Up" %}</a>
            {% endif %}
            
            <!-- Language Switcher -->
            <div class="language-switcher" style="position: relative; display: inline-block;" id="languageSwitcher">
              <button onclick="toggleLanguageMenu(event)" class="icon-button" style="font-size: 0.875rem; gap: 0.25rem; padding: 0.5rem 0.75rem;" title="{% trans 'Change language' %}">
                üåê <span style="font-weight: 600;">{{ LANGUAGE_CODE|slice:":2"|upper }}</span>
              </button>
              <div id="languageDropdown" style="display: none; position: fixed; background: #1a1a1a; border: 2px solid #3f3f46; border-radius: 8px; min-width: 200px; box-shadow: 0 10px 40px rgba(0,0,0,0.7); z-index: 10002; overflow: hidden; padding: 0.5rem 0;">
                <form action="{% url 'set_language' %}" method="post" style="margin: 0;">
                  {% csrf_token %}
                  <input name="next" type="hidden" value="{{ request.path }}">
                  {% get_current_language as LANGUAGE_CODE %}
                  {% get_available_languages as LANGUAGES %}
                  {% for lang_code, lang_name in LANGUAGES %}
                  <button type="submit" name="language" value="{{ lang_code }}" 
                          style="width: 100% !important; padding: 0.75rem 1.25rem !important; background: {% if lang_code == LANGUAGE_CODE %}#27272a{% else %}transparent{% endif %} !important; 
                                 border: none !important; color: {% if lang_code == LANGUAGE_CODE %}#a3e635{% else %}#d4d4d8{% endif %} !important; 
                                 text-align: left !important; cursor: pointer !important; transition: all 0.2s ease !important; 
                                 font-size: 0.9375rem !important; font-weight: {% if lang_code == LANGUAGE_CODE %}600{% else %}400{% endif %} !important; 
                                 display: flex !important; align-items: center !important; gap: 0.75rem !important; line-height: 1.5 !important;"
                          onmouseover="if('{{ lang_code }}' !== '{{ LANGUAGE_CODE }}') { this.style.background='#27272a'; this.style.color='#ffffff'; }"
                          onmouseout="if('{{ lang_code }}' !== '{{ LANGUAGE_CODE }}') { this.style.background='transparent'; this.style.color='#d4d4d8'; }">
                    <span style="flex: 1 !important;">{{ lang_name }}</span>
                    {% if lang_code == LANGUAGE_CODE %}<span style="color: #a3e635 !important; font-size: 1.125rem !important;">‚úì</span>{% endif %}
                  </button>
                  {% endfor %}
                </form>
              </div>
            </div>
            
            <!-- Menu hamburguer para mobile -->
            <button class="icon-button" onclick="toggleMobileMenu()" style="display: block;" id="menuToggle">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- Search form inline no header -->
        <div id="searchFormContainer" style="position: fixed; top: 0; left: 0; right: 0; background: var(--bg-gray-900); border-bottom: 1px solid var(--border-gray-800); z-index: 101; display: none; height: 4rem;">
          <div class="container" style="height: 100%; display: flex; align-items: center; justify-content: center;">
            <form action="{% url 'core:explore' %}" method="get" style="width: 100%; max-width: 600px; position: relative;" id="searchForm">
              <input name="q" type="search" placeholder="{% trans 'Search...' %}" aria-label="{% trans 'Search components' %}" class="input" style="width: 100%; padding-left: 3rem; padding-right: 3rem;">
              <svg style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-gray-500);" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <button type="button" onclick="toggleSearch(event)" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: transparent; border: none; color: var(--text-gray-500); cursor: pointer; padding: 0.25rem;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </form>
          </div>
        </div>
      </div>
    </header>
    
    <!-- Mobile Menu -->
    <div id="mobileMenu" style="display: none; position: fixed; top: 4rem; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.98); backdrop-filter: blur(12px); z-index: 40; overflow-y: auto;">
      <div class="container" style="padding: 2rem 1rem;">
        <nav style="display: flex; flex-direction: column; gap: 0.5rem;">
          <a href="{% url 'core:home' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Home" %}</a>
          <a href="{% url 'core:explore' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Explore" %}</a>
          <a href="{% url 'core:pricing' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Pricing" %}</a>
          <a href="{% url 'core:faq' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">FAQ</a>
          {% if user.is_authenticated %}
            <a href="{% url 'core:minha_biblioteca' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Library" %}</a>
            <a href="{% url 'usuario:favoritos' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">‚ù§Ô∏è Favoritos</a>
            <a href="{% url 'core:cart' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Cart" %}</a>
            <a href="{% url 'support:ticket_list' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">üí¨ {% trans "Support" %}</a>
            <a href="{% url 'usuario:profile' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Profile" %}</a>
            <a href="{% url 'usuario:signout' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem; border-top: 1px solid var(--border-gray-800); margin-top: 0.5rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Sign Out" %}</a>
            {% if user.admin %}
              <a href="{% url 'core:admin_svg' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Manage SVG" %}</a>
            {% endif %}
          {% else %}
            <a href="{% url 'usuario:signin' %}" style="padding: 0.875rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast); font-size: 1rem; border-top: 1px solid var(--border-gray-800); margin-top: 0.5rem;" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Sign In" %}</a>
            <a href="{% url 'usuario:signup' %}" class="btn btn-primary" style="margin-top: 0.5rem;">{% trans "Sign Up" %}</a>
          {% endif %}
          
          <!-- Language selector in mobile menu -->
          <div style="border-top: 1px solid var(--border-gray-800); margin-top: 1rem; padding-top: 1rem;">
            <p style="color: var(--text-gray-400); font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">{% trans "Language" %}</p>
            <form action="{% url 'set_language' %}" method="post" style="display: flex; flex-direction: column; gap: 0.5rem;">
              {% csrf_token %}
              <input name="next" type="hidden" value="{{ request.path }}">
              {% get_current_language as LANGUAGE_CODE %}
              {% get_available_languages as LANGUAGES %}
              {% for lang_code, lang_name in LANGUAGES %}
              <button type="submit" name="language" value="{{ lang_code }}" 
                      style="padding: 0.75rem 1rem; background: {% if lang_code == LANGUAGE_CODE %}var(--bg-gray-900){% else %}transparent{% endif %}; 
                             border: 1px solid {% if lang_code == LANGUAGE_CODE %}var(--primary){% else %}var(--border-gray-800){% endif %}; 
                             border-radius: 0.5rem; color: {% if lang_code == LANGUAGE_CODE %}var(--primary){% else %}var(--text-gray-300){% endif %}; 
                             text-align: left; cursor: pointer; transition: var(--transition); font-size: 0.875rem; font-weight: {% if lang_code == LANGUAGE_CODE %}600{% else %}400{% endif %};"
                      onmouseover="if('{{ lang_code }}' !== '{{ LANGUAGE_CODE }}') { this.style.borderColor='var(--border-gray-700)'; this.style.color='var(--text-white)'; }"
                      onmouseout="if('{{ lang_code }}' !== '{{ LANGUAGE_CODE }}') { this.style.borderColor='var(--border-gray-800)'; this.style.color='var(--text-gray-300)'; }">
                üåê {{ lang_name }}
              </button>
              {% endfor %}
            </form>
          </div>
        </nav>
      </div>
    </div>

    <main style="min-height: calc(100vh - 12rem);">
      {% block sidebar %}
      {% endblock %}

      <section>
        {% block content %}
        <!-- Conte√∫do da p√°gina -->
        {% endblock %}
      </section>
    </main>

    <footer class="site-footer-dark">
      <div class="container">
        <div class="footer-grid" style="grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr;">
          <div>
            <a href="{% url 'core:home' %}" class="brand" style="margin-bottom: 1.5rem; display: inline-flex;">
              <span class="brand-icon">A</span>
              <span>AkkaUi</span>
            </a>
            <p style="color: var(--text-gray-400); font-size: 0.875rem; line-height: 1.5; margin-top: 1rem;">{% trans "Your complete catalog of modern and responsive UI design resources." %}</p>
          </div>
          
          <div>
            <h4>{% trans "Product" %}</h4>
            <ul>
              <li><a href="{% url 'core:explore' %}">{% trans "Explore" %}</a></li>
              <li><a href="{% url 'core:pricing' %}">{% trans "Pricing" %}</a></li>
              <li><a href="{% url 'core:faq' %}">FAQ</a></li>
            </ul>
          </div>
          
          <div>
            <h4>{% trans "Resources" %}</h4>
            <ul>
              <li><a href="#">{% trans "Documentation" %}</a></li>
              <li><a href="#">{% trans "Tutorials" %}</a></li>
              <li><a href="#">{% trans "Blog" %}</a></li>
            </ul>
          </div>
          
          <div>
            <h4>{% trans "Company" %}</h4>
            <ul>
              <li><a href="#">{% trans "About" %}</a></li>
              <li><a href="#">{% trans "Contact" %}</a></li>
              <li><a href="#">{% trans "Terms" %}</a></li>
              {% if user.is_authenticated %}
                <li><a href="{% url 'support:ticket_list' %}" style="color: var(--accent); font-weight: 600;">üí¨ {% trans "Support" %}</a></li>
              {% endif %}
            </ul>
          </div>
          
          <div>
            <h4>{% trans "Community" %}</h4>
            <p style="color: var(--text-gray-400); font-size: 0.875rem; margin-bottom: 1rem;">{% trans "Follow us" %}</p>
            <div class="social-links">
              <a href="#" class="social-icon" aria-label="Facebook">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
              </a>
              <a href="#" class="social-icon" aria-label="Instagram">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
              </a>
              <a href="#" class="social-icon" aria-label="LinkedIn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
              <a href="#" class="social-icon" aria-label="YouTube">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
        
        <div class="brand-large">
          akkaui
        </div>
        
        <div style="text-align: center; padding-top: 2rem; border-top: 1px solid var(--border-gray-900); color: var(--text-gray-500); font-size: 0.875rem;">
          <p>¬© {{ year|default:2025 }} AkkaUi. {% trans "All rights reserved." %}</p>
        </div>
      </div>
    </footer>

    <script>
      // Notification System
      window.showNotification = function(message, type = 'success') {
        const container = document.getElementById('notificationContainer');
        const notification = document.createElement('div');
        
        const bgColors = {
          success: 'linear-gradient(135deg, rgba(163, 230, 53, 0.95), rgba(132, 204, 22, 0.95))',
          error: 'linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95))',
          info: 'linear-gradient(135deg, rgba(59, 130, 246, 0.95), rgba(37, 99, 235, 0.95))'
        };
        
        notification.style.cssText = `
          background: ${bgColors[type] || bgColors.success};
          color: white;
          padding: 1rem 1.5rem;
          border-radius: 0.75rem;
          box-shadow: 0 10px 25px rgba(0,0,0,0.3);
          display: flex;
          align-items: center;
          gap: 0.75rem;
          min-width: 300px;
          max-width: 400px;
          animation: slideInRight 0.3s ease;
          font-weight: 500;
          font-size: 0.9375rem;
        `;
        
        const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚Ñπ';
        notification.innerHTML = `
          <span style="font-size: 1.25rem; font-weight: bold;">${icon}</span>
          <span style="flex: 1;">${message}</span>
          <button onclick="this.parentElement.remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 1.5rem; height: 1.5rem; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; font-weight: bold;">√ó</button>
        `;
        
        container.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'slideOutRight 0.3s ease';
          setTimeout(() => notification.remove(), 300);
        }, 4000);
      };
      
      // Mobile menu toggle
      function toggleMobileMenu() {
        const menu = document.getElementById('mobileMenu');
        menu.style.display = menu.style.display === 'none' || menu.style.display === '' ? 'block' : 'none';
      }
      
      // Search toggle
      let searchToggleLock = false;
      function toggleSearch(event) {
        // Prevenir m√∫ltiplas execu√ß√µes simult√¢neas
        if (searchToggleLock) return;
        searchToggleLock = true;
        
        const searchContainer = document.getElementById('searchFormContainer');
        const searchForm = document.getElementById('searchForm');
        if (!searchContainer || !searchForm) {
          searchToggleLock = false;
          return;
        }
        
        // Move para body na primeira vez para evitar clipping por parents
        if (!searchContainer.dataset.moved) {
          searchContainer.dataset.moved = 'true';
          document.body.appendChild(searchContainer);
        }
        
        const searchInput = searchForm.querySelector('input');
        if (!searchInput) {
          searchToggleLock = false;
          return;
        }

        // Toggle: verificar estado atual de forma robusta
        const isVisible = searchContainer.style.display === 'flex';
        
        if (!isVisible) {
          // Abrir
          searchContainer.style.display = 'flex';
          setTimeout(() => searchInput.focus(), 100);
        } else {
          // Fechar
          searchContainer.style.display = 'none';
          searchInput.value = '';
        }
        
        // Liberar lock ap√≥s um pequeno delay
        setTimeout(() => { searchToggleLock = false; }, 50);
      }

      // Language menu toggle
      function toggleLanguageMenu(evt) {
        const button = evt ? evt.target.closest('button') : null;
        const dropdown = document.getElementById('languageDropdown');
        if (!dropdown) return;

        // Move para body na primeira vez para evitar clipping por parents
        if (!dropdown.dataset.moved) {
          dropdown.dataset.moved = 'true';
          document.body.appendChild(dropdown);
        }

        // Toggle
        if (dropdown.style.display === 'none' || dropdown.style.display === '') {
          const rect = button ? button.getBoundingClientRect() : { bottom: 48, left: 16 };

          // Preparar para medir: mostrar invis√≠vel para obter offsetWidth
          dropdown.style.position = 'fixed';
          dropdown.style.top = (rect.bottom + 8) + 'px';
          dropdown.style.left = '0px';
          dropdown.style.right = 'auto';
          dropdown.style.visibility = 'hidden';
          dropdown.style.display = 'block';

          // Medir largura real
          const ddWidth = dropdown.offsetWidth || 220; // fallback
          const margin = 8; // margem da borda da janela
          const extraScrollbarPadding = 12; // compensar barra lateral / overlay

          // Calcular left garantindo que n√£o ultrapasse as bordas.
          // Subtra√≠mos um padding extra quando perto da borda para evitar sobreposi√ß√£o com a barra lateral.
          let left = rect.left;
          if (left + ddWidth > window.innerWidth - margin) {
            left = window.innerWidth - ddWidth - margin - extraScrollbarPadding;
          }
          if (left < margin) left = margin;

          dropdown.style.left = left + 'px';
          dropdown.style.right = 'auto';
          dropdown.style.visibility = 'visible';
        } else {
          dropdown.style.display = 'none';
        }
      }

      // Close menus when clicking outside
      document.addEventListener('click', function(event) {
        const mobileMenu = document.getElementById('mobileMenu');
        const menuButton = event.target.closest('[onclick*="toggleMobileMenu"]');
        const searchContainer = document.getElementById('searchFormContainer');
        const searchButton = event.target.closest('[onclick*="toggleSearch"]');
        const languageSwitcher = document.getElementById('languageSwitcher');
        const languageButton = event.target.closest('[onclick*="toggleLanguageMenu"]');
        const languageDropdown = document.getElementById('languageDropdown');

        // Mobile menu
        if (mobileMenu && !menuButton && !mobileMenu.contains(event.target)) {
          mobileMenu.style.display = 'none';
        }

        // Search form
        if (searchContainer && !searchButton && !searchContainer.contains(event.target)) {
          searchContainer.style.display = 'none';
          const searchInput = searchContainer.querySelector('input');
          if (searchInput) searchInput.value = '';
        }

        // Language dropdown: se o clique n√£o for no bot√£o nem dentro do pr√≥prio dropdown, fechar
        const clickedInsideDropdown = languageDropdown && languageDropdown.contains(event.target);
        const clickedInsideSwitcher = languageSwitcher && languageSwitcher.contains(event.target);
        if (!languageButton && !clickedInsideDropdown && !clickedInsideSwitcher) {
          if (languageDropdown) languageDropdown.style.display = 'none';
        }
      });
      
      // Show desktop nav on larger screens
      window.addEventListener('resize', function() {
        const desktopNav = document.getElementById('desktopNav');
        const menuToggle = document.getElementById('menuToggle');
        const signinBtn = document.getElementById('signinBtn');
        const signupBtn = document.getElementById('signupBtn');
        
        if (window.innerWidth >= 768) {
          desktopNav.style.display = 'flex';
          menuToggle.style.display = 'none';
          if (signinBtn) signinBtn.style.display = 'inline-flex';
          if (signupBtn) signupBtn.style.display = 'inline-flex';
          document.getElementById('mobileMenu').style.display = 'none';
        } else {
          desktopNav.style.display = 'none';
          menuToggle.style.display = 'block';
          if (signinBtn) signinBtn.style.display = 'none';
          if (signupBtn) signupBtn.style.display = 'none';
        }
      });
      
      // Initialize on load
      window.addEventListener('DOMContentLoaded', function() {
        if (window.innerWidth >= 768) {
          document.getElementById('desktopNav').style.display = 'flex';
          document.getElementById('menuToggle').style.display = 'none';
          const signinBtn = document.getElementById('signinBtn');
          const signupBtn = document.getElementById('signupBtn');
          if (signinBtn) signinBtn.style.display = 'inline-flex';
          if (signupBtn) signupBtn.style.display = 'inline-flex';
        }
      });
      
      // Add CSS animations
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInRight {
          from { transform: translateX(400px); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(400px); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    </script>
    
    <!-- Shopping Cart Script -->
    <script>
      // Shopping Cart Management
      (function() {
        // Get cart from localStorage
        function getCart() {
          try {
            return JSON.parse(localStorage.getItem('akka_cart') || '[]');
          } catch {
            return [];
          }
        }

        // Save cart to localStorage
        function saveCart(cart) {
          localStorage.setItem('akka_cart', JSON.stringify(cart));
          updateCartBadge();
        }

        // Add item to cart
        window.addToCart = function(id, name, price) {
          const cart = getCart();
          const existingItem = cart.find(item => item.id === id);
          
          if (existingItem) {
            existingItem.quantity += 1;
          } else {
            cart.push({ id, name, price: parseFloat(price), quantity: 1, type: 'svg' });
          }
          
          saveCart(cart);
          showCartNotification(name);
        };

        // Show notification
        function showCartNotification(name) {
          const notification = document.createElement('div');
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
          `;
          notification.textContent = `‚úì "${name}" adicionado ao carrinho!`;
          document.body.appendChild(notification);
          
          setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
          }, 2000);
        }

        // Update cart badge
        function updateCartBadge() {
          const cart = getCart();
          const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
          
          let badge = document.getElementById('cart-badge');
          if (!badge && totalItems > 0) {
            const cartLink = document.querySelector('a[href*="cart"]');
            if (cartLink) {
              badge = document.createElement('span');
              badge.id = 'cart-badge';
              badge.style.cssText = `
                position: absolute;
                top: -8px;
                right: -8px;
                background: #ff4444;
                color: white;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                font-size: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
              `;
              cartLink.style.position = 'relative';
              cartLink.appendChild(badge);
            }
          }
          
          if (badge) {
            badge.textContent = totalItems;
            badge.style.display = totalItems > 0 ? 'flex' : 'none';
          }
        }

        // Initialize on load
        updateCartBadge();

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
          @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
      })();
    </script>
    
    <!-- Favorites Management Script -->
    <script>
      // Favorites Management
      (function() {
  let userFavorites = [];

  // SVGs usados para os estados de favorito
  const SVG_FAV_TRUE = '<svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">\n  <path d="M14.44 0C12.63 0 11.01 0.88 10 2.23C8.99 0.88 7.37 0 5.56 0C2.49 0 0 2.5 0 5.59C0 6.78 0.19 7.88 0.52 8.9C2.1 13.9 6.97 16.89 9.38 17.71C9.72 17.83 10.28 17.83 10.62 17.71C13.03 16.89 17.9 13.9 19.48 8.9C19.81 7.88 20 6.78 20 5.59C20 2.5 17.51 0 14.44 0Z" fill="#7460F3"/>\n</svg>';
  const SVG_FAV_FALSE = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">\n  <path d="M16.44 3.1C14.63 3.1 13.01 3.98 12 5.33C10.99 3.98 9.37 3.1 7.56 3.1C4.49 3.1 2 5.6 2 8.69C2 9.88 2.19 10.98 2.52 12C4.1 17 8.97 19.99 11.38 20.81C11.72 20.93 12.28 20.93 12.62 20.81C15.03 19.99 19.9 17 21.48 12C21.81 10.98 22 9.88 22 8.69C22 5.6 19.51 3.1 16.44 3.1Z" fill="#1E1E1E"/>\n</svg>';
        
        // Load user favorites on page load
        function loadFavorites() {
          {% if user.is_authenticated %}
          fetch('{% url "usuario:get_favorites" %}', {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              userFavorites = data.favorite_ids || [];
              updateFavoriteIcons();
            }
          })
          .catch(error => console.error('Erro ao carregar favoritos:', error));
          {% endif %}
        }
        
        // Update favorite icons based on current state
        function updateFavoriteIcons() {
          document.querySelectorAll('.favorite-btn').forEach(btn => {
            const svgId = parseInt(btn.dataset.svgId);
            const icon = btn.querySelector('.favorite-icon');
            if (!icon) return;
            if (userFavorites.includes(svgId)) {
              icon.innerHTML = SVG_FAV_TRUE;
            } else {
              icon.innerHTML = SVG_FAV_FALSE;
            }
          });
        }
        
        // Toggle favorite
        window.toggleFavorite = function(svgId, btnElement) {
          {% if user.is_authenticated %}
          const icon = btnElement.querySelector('.favorite-icon');
          if (!icon) return;
          const originalIcon = icon.innerHTML;

          // Anima√ß√£o de loading (texto simples)
          icon.innerHTML = '‚è≥';
          btnElement.disabled = true;
          
          fetch('{% url "usuario:toggle_favorite" %}', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({ svg_id: svgId })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              if (data.is_favorited) {
                userFavorites.push(svgId);
                icon.innerHTML = SVG_FAV_TRUE;
                if (typeof showNotification === 'function') {
                  showNotification('Adicionado aos favoritos!', 'success');
                }
              } else {
                userFavorites = userFavorites.filter(id => id !== svgId);
                icon.innerHTML = SVG_FAV_FALSE;
                if (typeof showNotification === 'function') {
                  showNotification('Removido dos favoritos', 'info');
                }
                // Se estamos na p√°gina de favoritos, recarregar a p√°gina
                if (window.location.pathname.includes('favoritos')) {
                  setTimeout(() => window.location.reload(), 500);
                }
              }
            } else {
              icon.textContent = originalIcon;
              if (typeof showNotification === 'function') {
                showNotification('Erro ao atualizar favorito', 'error');
              }
            }
          })
          .catch(error => {
            console.error('Erro ao favoritar:', error);
            icon.textContent = originalIcon;
            if (typeof showNotification === 'function') {
              showNotification('Erro ao atualizar favorito', 'error');
            }
          })
          .finally(() => {
            btnElement.disabled = false;
          });
          {% else %}
          // Redirecionar para login se n√£o autenticado
          window.location.href = '{% url "usuario:signin" %}?next=' + encodeURIComponent(window.location.pathname);
          {% endif %}
        };
        
        // Get CSRF token from cookies
        function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
              }
            }
          }
          return cookieValue;
        }
        
        // Initialize on page load
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', loadFavorites);
        } else {
          loadFavorites();
        }
      })();
    </script>
    
    {% block extra_js %}{% endblock %}
  </body>
</html>
