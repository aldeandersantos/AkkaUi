# Configuração Nginx para arquivos protegidos com X-Accel-Redirect
# 
# Este arquivo deve ser incluído na configuração do seu servidor Nginx.
# Exemplo de uso no bloco server:
#
# server {
#     listen 80;
#     server_name example.com;
#     
#     # ... outras configurações ...
#     
#     # Proxy para Django
#     location / {
#         proxy_pass http://127.0.0.1:8000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
#     
#     # Incluir este arquivo
#     include /path/to/nginx_protected_media.conf;
# }

# Bloco location interno para servir arquivos protegidos
# A diretiva 'internal' garante que esta localização só pode ser acessada
# via redirecionamento interno (X-Accel-Redirect), não diretamente pelos clientes
location /internal_media/ {
    # Apenas acessível internamente via X-Accel-Redirect
    internal;
    
    # Mapeia para o diretório real onde os arquivos estão armazenados
    # Ajuste o caminho abaixo para corresponder ao seu MEDIA_ROOT
    alias /path/to/your/project/media/;
    
    # Exemplo de caminho absoluto:
    # alias /home/user/AkkaUi/media/;
    
    # Ou usando variável de ambiente (requer configuração adicional):
    # alias $media_root/;
}

# Bloqueio adicional: garante que arquivos em /media/ não sejam servidos diretamente
# em produção (apenas através do guardian)
# Comente esta seção se você ainda precisa servir alguns arquivos públicos via /media/
location /media/ {
    # Retorna 403 (Forbidden) para acesso direto
    # Em produção, apenas o guardian deve servir arquivos privados
    return 403;
    
    # Alternativa: permitir apenas arquivos públicos específicos
    # location ~* ^/media/public/.*\.(jpg|jpeg|png|gif|svg)$ {
    #     alias /path/to/your/project/media/;
    # }
}
