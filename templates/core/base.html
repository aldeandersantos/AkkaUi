{% load static %}
{% load i18n %}
<!doctype html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}AkkaUi{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'core/design-system.css' %}">
    <link rel="stylesheet" href="{% static 'core/wiki.css' %}">
    <link rel="stylesheet" href="{% static 'core/ui-enhancements.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'Favicon.ico' %}">
    
    <!-- HTMX para intera√ß√µes din√¢micas sem JavaScript complexo -->
    <script src="https://unpkg.com/htmx.org@1.9.10" 
            integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" 
            crossorigin="anonymous"></script>
    
    <!-- Alpine.js para reatividade leve (modais, toggles) -->
    <script defer src="https://unpkg.com/alpinejs@3.13.5/dist/cdn.min.js" 
            integrity="sha384-Uz679UqE3+L2WCGSYkh+Y2KnGFN7aRRLJMWc9lL3QYAKrVEkbydCPvFODHOcbH1M" 
            crossorigin="anonymous"></script>
    
    {% block extra_head %}{% endblock %}
  </head>
  <body>
    <header class="site-header-dark">
      <div class="container">
        <div style="display: flex; align-items: center; gap: 2rem;">
          <a href="{% url 'core:home' %}" class="brand">
            <span class="brand-icon">A</span>
            <span>AkkaUi</span>
          </a>
          
          <nav class="nav" style="display: none;" id="mainNav">
            <a href="{% url 'core:home' %}" {% if request.path == '/' %}class="active"{% endif %}>{% trans "Home" %}</a>
            <a href="{% url 'core:explore' %}" {% if 'explore' in request.path %}class="active"{% endif %}>{% trans "Explore" %}</a>
            <a href="{% url 'core:pricing' %}" {% if 'pricing' in request.path %}class="active"{% endif %}>{% trans "Pricing" %}</a>
            <a href="{% url 'core:faq' %}" {% if 'faq' in request.path %}class="active"{% endif %}>FAQ</a>
            {% if user.is_authenticated %}
              <a href="{% url 'core:minha_biblioteca' %}" {% if 'minha-biblioteca' in request.path %}class="active"{% endif %}>{% trans "Library" %}</a>
            {% endif %}
            {% if user.is_authenticated and user.admin %}
              <a href="{% url 'core:admin_svg' %}" {% if 'manage/svg' in request.path %}class="active"{% endif %}>{% trans "Manage SVG" %}</a>
            {% endif %}
          </nav>
          
          <button class="icon-button" onclick="toggleMenu()" style="display: block; margin-left: auto;">‚ò∞</button>
        </div>
        
        <div class="actions">
          <form action="{% url 'core:explore' %}" method="get" style="position: relative; display: none;" id="searchForm">
            <input name="q" type="search" placeholder="{% trans 'Search...' %}" aria-label="{% trans 'Search components' %}" class="input" style="padding-right: 2.5rem; width: 200px;">
            <button type="button" onclick="toggleSearch()" style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-gray-400); cursor: pointer;">‚úï</button>
          </form>
          
          <button class="icon-button" onclick="toggleSearch()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
          
          {% if user.is_authenticated %}
            <a href="{% url 'core:cart' %}" class="icon-button" style="position: relative; text-decoration: none;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
            </a>
          {% endif %}
          
          <div class="language-switcher" style="position: relative;">
            <button onclick="toggleLanguageMenu()" class="btn btn-outline" style="padding: 0.5rem 0.75rem; font-size: 0.875rem; height: auto;">
              üåê {{ LANGUAGE_CODE|upper }}
            </button>
            <div id="languageMenu" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 0.5rem; background: var(--bg-gray-900); border: 1px solid var(--border-gray-800); border-radius: 0.5rem; min-width: 180px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000;">
              <form action="{% url 'set_language' %}" method="post" style="margin: 0;">
                {% csrf_token %}
                <input name="next" type="hidden" value="{{ request.path }}">
                {% get_current_language as LANGUAGE_CODE %}
                {% get_available_languages as LANGUAGES %}
                {% for lang_code, lang_name in LANGUAGES %}
                <button type="submit" name="language" value="{{ lang_code }}" 
                        style="width: 100%; padding: 0.75rem 1rem; background: {% if lang_code == LANGUAGE_CODE %}var(--primary){% else %}transparent{% endif %}; 
                               border: none; color: {% if lang_code == LANGUAGE_CODE %}var(--bg-black){% else %}var(--text-gray-300){% endif %}; 
                               text-align: left; cursor: pointer; transition: var(--transition-fast); font-size: 0.875rem; font-weight: 500;">
                  {{ lang_name }}
                </button>
                {% endfor %}
              </form>
            </div>
          </div>
          
          {% if user.is_authenticated %}
            <div style="position: relative;" x-data="{ open: false }">
              <button @click="open = !open" class="icon-button" style="width: 2rem; height: 2rem; background-color: var(--primary); border-radius: 50%; color: var(--bg-black); font-weight: 600; font-size: 0.875rem;">
                {{ user.username|slice:":1"|upper }}
              </button>
              <div x-show="open" @click.outside="open = false" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 0.5rem; background: var(--bg-gray-900); border: 1px solid var(--border-gray-800); border-radius: 0.5rem; min-width: 180px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000;" x-bind:style="open ? 'display: block' : 'display: none'">
                <a href="{% url 'usuario:profile' %}" style="display: block; padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; transition: var(--transition-fast); font-size: 0.875rem;">{% trans "Profile" %}</a>
                <a href="{% url 'usuario:signout' %}" style="display: block; padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; transition: var(--transition-fast); font-size: 0.875rem; border-top: 1px solid var(--border-gray-800);">{% trans "Sign Out" %}</a>
              </div>
            </div>
          {% else %}
            <a href="{% url 'usuario:signin' %}" class="btn btn-outline" style="padding: 0.5rem 1rem; font-size: 0.875rem; height: auto;">{% trans "Sign In" %}</a>
            <a href="{% url 'usuario:signup' %}" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem; height: auto;">{% trans "Sign Up" %}</a>
          {% endif %}
        </div>
      </div>
    </header>
    
    <!-- Mobile Menu -->
    <div id="mobileMenu" style="display: none; position: fixed; top: 4rem; left: 0; right: 0; background: rgba(0, 0, 0, 0.98); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-gray-800); z-index: 40; padding: 1rem;">
      <nav style="display: flex; flex-direction: column; gap: 0.5rem;">
        <a href="{% url 'core:home' %}" style="padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast);" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Home" %}</a>
        <a href="{% url 'core:explore' %}" style="padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast);" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Explore" %}</a>
        <a href="{% url 'core:pricing' %}" style="padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast);" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Pricing" %}</a>
        <a href="{% url 'core:faq' %}" style="padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast);" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">FAQ</a>
        {% if user.is_authenticated %}
          <a href="{% url 'core:minha_biblioteca' %}" style="padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast);" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Library" %}</a>
          <a href="{% url 'core:cart' %}" style="padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast);" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Cart" %}</a>
          {% if user.admin %}
            <a href="{% url 'core:admin_svg' %}" style="padding: 0.75rem 1rem; color: var(--text-gray-300); text-decoration: none; border-radius: 0.5rem; transition: var(--transition-fast);" onmouseover="this.style.backgroundColor='var(--bg-gray-900)'; this.style.color='var(--text-white)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-gray-300)'">{% trans "Manage SVG" %}</a>
          {% endif %}
        {% endif %}
      </nav>
    </div>

    <main style="min-height: calc(100vh - 12rem);">
      {% block sidebar %}
      {% endblock %}

      <section>
        {% block content %}
        <!-- Conte√∫do da p√°gina -->
        {% endblock %}
      </section>
    </main>

    <footer class="site-footer-dark">
      <div class="container">
        <div class="footer-grid" style="grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr;">
          <div>
            <a href="{% url 'core:home' %}" class="brand" style="margin-bottom: 1.5rem; display: inline-flex;">
              <span class="brand-icon">A</span>
              <span>AkkaUi</span>
            </a>
            <p style="color: var(--text-gray-400); font-size: 0.875rem; line-height: 1.5; margin-top: 1rem;">{% trans "Your complete catalog of modern and responsive UI design resources." %}</p>
          </div>
          
          <div>
            <h4>{% trans "Product" %}</h4>
            <ul>
              <li><a href="{% url 'core:explore' %}">{% trans "Explore" %}</a></li>
              <li><a href="{% url 'core:pricing' %}">{% trans "Pricing" %}</a></li>
              <li><a href="{% url 'core:faq' %}">FAQ</a></li>
            </ul>
          </div>
          
          <div>
            <h4>{% trans "Resources" %}</h4>
            <ul>
              <li><a href="#">{% trans "Documentation" %}</a></li>
              <li><a href="#">{% trans "Tutorials" %}</a></li>
              <li><a href="#">{% trans "Blog" %}</a></li>
            </ul>
          </div>
          
          <div>
            <h4>{% trans "Company" %}</h4>
            <ul>
              <li><a href="#">{% trans "About" %}</a></li>
              <li><a href="#">{% trans "Contact" %}</a></li>
              <li><a href="#">{% trans "Terms" %}</a></li>
            </ul>
          </div>
          
          <div>
            <h4>{% trans "Community" %}</h4>
            <p style="color: var(--text-gray-400); font-size: 0.875rem; margin-bottom: 1rem;">{% trans "Follow us" %}</p>
            <div class="social-links">
              <a href="#" class="social-icon" aria-label="Facebook">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
              </a>
              <a href="#" class="social-icon" aria-label="Instagram">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
              </a>
              <a href="#" class="social-icon" aria-label="LinkedIn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
              <a href="#" class="social-icon" aria-label="YouTube">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
        
        <div class="brand-large">
          akkaui
        </div>
        
        <div style="text-align: center; padding-top: 2rem; border-top: 1px solid var(--border-gray-900); color: var(--text-gray-500); font-size: 0.875rem;">
          <p>¬© {{ year|default:2025 }} AkkaUi. {% trans "All rights reserved." %}</p>
        </div>
      </div>
    </footer>

    <script>
      function toggleMenu() {
        const menu = document.getElementById('mobileMenu');
        const nav = document.getElementById('mainNav');
        
        if (menu.style.display === 'none' || menu.style.display === '') {
          menu.style.display = 'block';
          nav.style.display = 'flex';
        } else {
          menu.style.display = 'none';
          nav.style.display = 'none';
        }
      }
      
      function toggleSearch() {
        const searchForm = document.getElementById('searchForm');
        const searchInput = searchForm.querySelector('input');
        
        if (searchForm.style.display === 'none' || searchForm.style.display === '') {
          searchForm.style.display = 'block';
          searchInput.focus();
        } else {
          searchForm.style.display = 'none';
          searchInput.value = '';
        }
      }

      function toggleLanguageMenu() {
        const menu = document.getElementById('languageMenu');
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
      }

      // Close menus when clicking outside
      document.addEventListener('click', function(event) {
        const nav = document.getElementById('mainNav');
        const mobileMenu = document.getElementById('mobileMenu');
        const menuButton = event.target.closest('[onclick*="toggleMenu"]');
        const langMenu = document.getElementById('languageMenu');
        const langSwitcher = document.querySelector('.language-switcher');
        const searchForm = document.getElementById('searchForm');
        const searchButton = event.target.closest('[onclick*="toggleSearch"]');
        
        if (!menuButton && !mobileMenu.contains(event.target)) {
          mobileMenu.style.display = 'none';
          nav.style.display = 'none';
        }
        
        if (langSwitcher && !langSwitcher.contains(event.target)) {
          langMenu.style.display = 'none';
        }
        
        if (!searchButton && !searchForm.contains(event.target)) {
          searchForm.style.display = 'none';
        }
      });
      
      // Show desktop nav on larger screens
      window.addEventListener('resize', function() {
        const nav = document.getElementById('mainNav');
        const mobileMenu = document.getElementById('mobileMenu');
        
        if (window.innerWidth >= 768) {
          nav.style.display = 'flex';
          mobileMenu.style.display = 'none';
        } else {
          nav.style.display = 'none';
        }
      });
      
      // Initialize
      if (window.innerWidth >= 768) {
        document.getElementById('mainNav').style.display = 'flex';
      }
    </script>
    
    <!-- Shopping Cart Script -->
    <script>
      // Shopping Cart Management
      (function() {
        // Get cart from localStorage
        function getCart() {
          try {
            return JSON.parse(localStorage.getItem('akka_cart') || '[]');
          } catch {
            return [];
          }
        }

        // Save cart to localStorage
        function saveCart(cart) {
          localStorage.setItem('akka_cart', JSON.stringify(cart));
          updateCartBadge();
        }

        // Add item to cart
        window.addToCart = function(id, name, price) {
          const cart = getCart();
          const existingItem = cart.find(item => item.id === id);
          
          if (existingItem) {
            existingItem.quantity += 1;
          } else {
            cart.push({ id, name, price: parseFloat(price), quantity: 1, type: 'svg' });
          }
          
          saveCart(cart);
          showCartNotification(name);
        };

        // Show notification
        function showCartNotification(name) {
          const notification = document.createElement('div');
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
          `;
          notification.textContent = `‚úì "${name}" adicionado ao carrinho!`;
          document.body.appendChild(notification);
          
          setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
          }, 2000);
        }

        // Update cart badge
        function updateCartBadge() {
          const cart = getCart();
          const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
          
          let badge = document.getElementById('cart-badge');
          if (!badge && totalItems > 0) {
            const cartLink = document.querySelector('a[href*="cart"]');
            if (cartLink) {
              badge = document.createElement('span');
              badge.id = 'cart-badge';
              badge.style.cssText = `
                position: absolute;
                top: -8px;
                right: -8px;
                background: #ff4444;
                color: white;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                font-size: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
              `;
              cartLink.style.position = 'relative';
              cartLink.appendChild(badge);
            }
          }
          
          if (badge) {
            badge.textContent = totalItems;
            badge.style.display = totalItems > 0 ? 'flex' : 'none';
          }
        }

        // Initialize on load
        updateCartBadge();

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
          @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
      })();
    </script>
    
    {% block extra_js %}{% endblock %}
  </body>
</html>
