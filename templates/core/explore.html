{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Explore" %} â€” AkkaUi{% endblock %}

{% block content %}
<div style="background: var(--bg-dark); min-height: 100vh;">
  <!-- Header Section -->
  <section style="background: var(--bg-dark); padding: 4rem 0 2rem;">
    <div class="container">
      <div style="max-width: 48rem; margin: 0 auto; text-align: center;">
        <h1 style="font-size: 3rem; font-weight: 700; color: var(--text-light); margin-bottom: 1rem;">
          {% trans "Explore SVGs" %}
        </h1>
        <p style="color: var(--text-muted); font-size: 1.125rem; margin-bottom: 2rem;">
          {% trans "Discover our collection of SVGs saved in the system" %}
        </p>
        
        <!-- Search Bar -->
        <form method="get" action="{% url 'core:explore' %}" class="search-wrapper">
          <i data-lucide="search" class="search-icon" style="width: 20px; height: 20px;"></i>
          <input
            type="search"
            name="q"
            value="{{ search_query }}"
            placeholder="{% trans 'Search by title...' %}"
            class="search-input"
          />
          <input type="hidden" name="category" value="{{ selected_category }}">
          <input type="hidden" name="tag" value="{{ selected_tag }}">
          <input type="hidden" name="sort" value="{{ selected_sort }}">
        </form>
      </div>
    </div>
  </section>

  <!-- Filters Section -->
  <section style="background: var(--bg-dark); padding: 1rem 0 2rem; border-top: 1px solid var(--border);">
    <div class="container">
      <form method="get" action="{% url 'core:explore' %}" style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; justify-content: center;">
        <!-- Category Filter -->
        <div style="position: relative;">
          <select name="category" class="search-input" style="padding-right: 2.5rem; min-width: 150px; appearance: none;" onchange="this.form.submit()">
            <option value="">{% trans "All Categories" %}</option>
            {% for cat in all_categories %}
              <option value="{{ cat }}" {% if cat == selected_category %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
          </select>
          <i data-lucide="chevron-down" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--text-muted); pointer-events: none;"></i>
        </div>
        
        <!-- Tag Filter -->
        <div style="position: relative;">
          <select name="tag" class="search-input" style="padding-right: 2.5rem; min-width: 120px; appearance: none;" onchange="this.form.submit()">
            <option value="">{% trans "All Tags" %}</option>
            {% for t in all_tags %}
              <option value="{{ t }}" {% if t == selected_tag %}selected{% endif %}>{{ t }}</option>
            {% endfor %}
          </select>
          <i data-lucide="chevron-down" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--text-muted); pointer-events: none;"></i>
        </div>
        
        <!-- Sort Filter -->
        <div style="position: relative;">
          <select name="sort" class="search-input" style="padding-right: 2.5rem; min-width: 150px; appearance: none;" onchange="this.form.submit()">
            <option value="-uploaded_at" {% if selected_sort == '-uploaded_at' %}selected{% endif %}>{% trans "Most recent" %}</option>
            <option value="uploaded_at" {% if selected_sort == 'uploaded_at' %}selected{% endif %}>{% trans "Oldest" %}</option>
            <option value="title_name" {% if selected_sort == 'title_name' %}selected{% endif %}>{% trans "Name (A-Z)" %}</option>
            <option value="-title_name" {% if selected_sort == '-title_name' %}selected{% endif %}>{% trans "Name (Z-A)" %}</option>
          </select>
          <i data-lucide="chevron-down" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--text-muted); pointer-events: none;"></i>
        </div>
        
        <!-- Clear Button -->
        {% if search_query or selected_category or selected_tag or selected_sort != '-uploaded_at' %}
          <a href="{% url 'core:explore' %}" class="btn btn-outline">
            <i data-lucide="x" style="width: 16px; height: 16px; margin-right: 4px;"></i>
            {% trans "Clear" %}
          </a>
        {% endif %}
        
        <input type="hidden" name="q" value="{{ search_query }}">
      </form>
    </div>
  </section>

  <!-- Results Section -->
  <section class="py-16">
    <div class="container">
      {% if svgfiles %}
        <!-- Results Counter -->
        <p style="color: var(--text-muted); margin-bottom: 2rem; text-align: center; font-size: 0.875rem;">
          {% if search_query or selected_category or selected_tag %}
            {% blocktrans count counter=svgfiles|length %}Found {{ counter }} result{% plural %}Found {{ counter }} results{% endblocktrans %}
          {% else %}
            {% blocktrans count counter=svgfiles|length %}Showing {{ counter }} public SVG{% plural %}Showing {{ counter }} public SVGs{% endblocktrans %}
          {% endif %}
        </p>
        
        <!-- SVG Grid -->
        <div class="grid grid-cols-1 grid-cols-2-sm grid-cols-4-lg">
          {% for item in svgfiles %}
            <div class="design-card" onclick="viewSVGDetails('{{ item.id }}')">
              <!-- Image Preview -->
              <div class="design-card-image">
                {% if item.preview_url %}
                  <img src="{{ item.preview_url }}" alt="{{ item.title }}" loading="lazy">
                {% else %}
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--color-gray-800);">
                    <i data-lucide="image" style="width: 3rem; height: 3rem; color: var(--text-muted);"></i>
                  </div>
                {% endif %}
              </div>
              
              <!-- Content -->
              <div class="design-card-content">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                  <h3 class="design-card-title" style="flex: 1; margin-right: 0.5rem;">{{ item.title }}</h3>
                  {% if not item.vip_access %}
                    <span class="badge badge-free">{% trans "Free" %}</span>
                  {% else %}
                    <span class="badge" style="background: var(--color-gray-800); color: var(--text-muted);">Premium</span>
                  {% endif %}
                </div>
                <p class="design-card-author">by {{ item.author|default:"AkkaUi" }}</p>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 0.5rem; margin-top: 0.75rem;">
                  <button onclick="event.stopPropagation(); addToCart('{{ item.id }}', '{{ item.title }}', '{{ item.price|default:"0" }}')" class="btn btn-primary" style="flex: 1; padding: 0.5rem; font-size: 0.875rem;">
                    <i data-lucide="shopping-cart" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                    {% trans "Add" %}
                  </button>
                  <button onclick="event.stopPropagation(); viewSVGDetails('{{ item.id }}')" class="btn btn-outline" style="padding: 0.5rem; font-size: 0.875rem;">
                    <i data-lucide="eye" style="width: 14px; height: 14px;"></i>
                  </button>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <!-- No Results -->
        <div style="text-align: center; padding: 4rem 1rem;">
          <i data-lucide="search-x" style="width: 4rem; height: 4rem; color: var(--text-muted); margin: 0 auto 1rem;"></i>
          <h3 style="color: var(--text-light); font-size: 1.5rem; margin-bottom: 0.5rem;">
            {% if search_query or selected_category or selected_tag %}
              {% trans "No results found" %}
            {% else %}
              {% trans "No SVGs available yet" %}
            {% endif %}
          </h3>
          <p style="color: var(--text-muted);">
            {% if search_query or selected_category or selected_tag %}
              {% trans "Try adjusting the filters." %}
            {% else %}
              {% trans "Upload the first one!" %}
            {% endif %}
          </p>
        </div>
      {% endif %}
    </div>
  </section>
</div>

<script>
  // Initialize Lucide icons
  lucide.createIcons();
  
  function viewSVGDetails(id) {
    // TODO: Open SVG details modal or navigate to detail page
    console.log('View SVG details:', id);
    // For now, you can implement navigation to a details page
    // window.location.href = `/svg/${id}/`;
  }
</script>
{% endblock %}
