{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Explore" %} — AkkaUi{% endblock %}

{% block meta_description %}{% trans "Explore nossa coleção completa de SVGs e componentes de design UI. Filtre por categoria, tag e encontre o design perfeito para seu projeto." %}{% endblock %}

{% block meta_keywords %}explore svg, search svg, ui components library, design catalog, svg collection, interface components, design resources, web design assets{% endblock %}

{% block og_title %}Explore Designs - AkkaUi{% endblock %}
{% block og_description %}Descubra nossa coleção completa de recursos de design UI. Filtre e encontre o design perfeito para seu projeto.{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Explore SVG Designs - AkkaUi",
  "description": "Catálogo completo de recursos de design UI com filtros e pesquisa",
  "url": "https://{{ request.get_host }}{% url 'core:explore' %}",
  "numberOfItems": {{ svgfiles|length }},
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ svgfiles|length }},
    "itemListElement": [
      {% for item in svgfiles|slice:":20" %}
      {
        "@type": "ListItem",
        "position": {{ forloop.counter }},
        "item": {
          "@type": "CreativeWork",
          "name": "{{ item.title_name }}",
          "description": "{{ item.category|default:'UI Design Component' }}",
          "category": "{{ item.category }}"
        }
      }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ]
  }
}
</script>
{% endblock %}

{% block sidebar %}
{# Sidebar sempre visível em desktop, toggle em mobile #}
<aside style="position: fixed; left: 0; top: 4rem; bottom: 0; width: 280px; background: var(--bg-gray-900); border-right: 1px solid var(--border-gray-800); padding: 1.5rem 1rem; overflow-y: auto; z-index: 30; transform: translateX(0); transition: transform 0.3s ease;" id="filterSidebar" class="explore-sidebar">
  {# Mobile close button #}
  <button onclick="toggleSidebar()" style="display: none; position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--text-gray-400); cursor: pointer; font-size: 1.5rem; padding: 0; line-height: 1; transition: var(--transition);" class="mobile-close" onmouseover="this.style.color='var(--text-white)'" onmouseout="this.style.color='var(--text-gray-400)'">×</button>
  
  <div style="margin-bottom: 1.5rem;">
    <h3 style="color: var(--text-white); font-size: 1.125rem; font-weight: 700; margin: 0;">{% trans "Filters" %}</h3>
  </div>
  
  <form method="get" action="{% url 'core:explore' %}" 
        hx-get="{% url 'core:explore' %}" 
        hx-target="#svgGrid" 
        hx-swap="innerHTML"
        hx-indicator="#loading-indicator"
        hx-push-url="true"
        style="display: flex; flex-direction: column; gap: 1.25rem;">
    {# Search #}
    <div>
      <label for="sidebar-search" style="display: block; color: var(--text-gray-300); font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">{% trans "Search" %}</label>
      <input 
        type="search" 
        name="q" 
        id="sidebar-search"
        value="{{ search_query }}" 
        placeholder="{% trans 'Type to search...' %}" 
        class="input"
        style="width: 100%; font-size: 0.875rem;"
        aria-label="{% trans 'Search SVGs by title' %}"
        hx-get="{% url 'core:explore' %}"
        hx-target="#svgGrid"
        hx-swap="innerHTML"
        hx-trigger="keyup changed delay:500ms, search"
        hx-include="[name='category'],[name='tag'],[name='sort']"
        hx-indicator="#loading-indicator"
        hx-push-url="true"
      >
    </div>
    
    {# Category #}
    <div>
      <label for="sidebar-category" style="display: block; color: var(--text-gray-300); font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">{% trans "Category" %}</label>
      <select name="category" id="sidebar-category" class="input" style="width: 100%; cursor: pointer; font-size: 0.875rem;"
              hx-get="{% url 'core:explore' %}"
              hx-target="#svgGrid"
              hx-swap="innerHTML"
              hx-trigger="change"
              hx-include="[name='q'],[name='tag'],[name='sort']"
              hx-indicator="#loading-indicator"
              hx-push-url="true">
        <option value="">{% trans "All" %}</option>
        {% for cat in all_categories %}
          <option value="{{ cat }}" {% if cat == selected_category %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
      </select>
    </div>
    
    {# Tag #}
    <div>
      <label for="sidebar-tag" style="display: block; color: var(--text-gray-300); font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">{% trans "Tag" %}</label>
      <select name="tag" id="sidebar-tag" class="input" style="width: 100%; cursor: pointer; font-size: 0.875rem;"
              hx-get="{% url 'core:explore' %}"
              hx-target="#svgGrid"
              hx-swap="innerHTML"
              hx-trigger="change"
              hx-include="[name='q'],[name='category'],[name='sort']"
              hx-indicator="#loading-indicator"
              hx-push-url="true">
        <option value="">{% trans "All" %}</option>
        {% for t in all_tags %}
          <option value="{{ t }}" {% if t == selected_tag %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
      </select>
    </div>
    
    {# Sort #}
    <div>
      <label for="sidebar-sort" style="display: block; color: var(--text-gray-300); font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">{% trans "Sort by" %}</label>
      <select name="sort" id="sidebar-sort" class="input" style="width: 100%; cursor: pointer; font-size: 0.875rem;"
              hx-get="{% url 'core:explore' %}"
              hx-target="#svgGrid"
              hx-swap="innerHTML"
              hx-trigger="change"
              hx-include="[name='q'],[name='category'],[name='tag']"
              hx-indicator="#loading-indicator"
              hx-push-url="true">
        <option value="-uploaded_at" {% if selected_sort == '-uploaded_at' %}selected{% endif %}>{% trans "Newest" %}</option>
        <option value="uploaded_at" {% if selected_sort == 'uploaded_at' %}selected{% endif %}>{% trans "Oldest" %}</option>
        <option value="title_name" {% if selected_sort == 'title_name' %}selected{% endif %}>{% trans "A-Z" %}</option>
        <option value="-title_name" {% if selected_sort == '-title_name' %}selected{% endif %}>{% trans "Z-A" %}</option>
      </select>
    </div>
    
    {# Actions #}
    <div style="display: flex; flex-direction: column; gap: 0.5rem; padding-top: 0.75rem; border-top: 1px solid var(--border-gray-800); margin-top: 0.5rem;">
      <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; font-size: 0.875rem; padding: 0.625rem 1rem;">
        {% trans "Apply" %}
      </button>
      {% if search_query or selected_category or selected_tag or selected_sort != '-uploaded_at' %}
        <a href="{% url 'core:explore' %}" class="btn btn-secondary" style="width: 100%; justify-content: center; text-align: center; text-decoration: none; font-size: 0.875rem; padding: 0.625rem 1rem;">
          {% trans "Clear" %}
        </a>
      {% endif %}
    </div>
  </form>
</aside>

{# Overlay para mobile #}
<div id="sidebarOverlay" style="display: none; position: fixed; top: 4rem; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 25;" onclick="toggleSidebar()"></div>

<style>
  @media (max-width: 1023px) {
    .explore-sidebar {
      transform: translateX(-100%);
    }
    .explore-sidebar.active {
      transform: translateX(0);
    }
    .mobile-close {
      display: block !important;
    }
  }
</style>
{% endblock %}

{% block content %}
<div style="margin-left: 280px; background: var(--bg-black); min-height: 100vh; transition: margin-left 0.3s ease;" id="mainContent">
  {# Header com título e toggle mobile #}
  <section style="padding: 2rem 0 1.5rem; border-bottom: 1px solid var(--border-gray-800);">
    <div class="container">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h1 style="color: var(--text-white); font-size: 2rem; font-weight: 700; margin: 0 0 0.25rem 0;">{% trans "Explore SVGs" %}</h1>
          {% if svgfiles %}
            <p style="color: var(--text-gray-400); font-size: 0.875rem; margin: 0;">
              {% blocktrans count counter=svgfiles|length %}{{ counter }} component{% plural %}{{ counter }} components{% endblocktrans %}
            </p>
          {% endif %}
        </div>
        
        {# Botão de filtro apenas em mobile #}
        <button onclick="toggleSidebar()" style="display: none; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: var(--bg-gray-900); border: 1px solid var(--border-gray-800); border-radius: var(--radius-lg); color: var(--text-gray-300); cursor: pointer; transition: var(--transition);" class="mobile-filter-btn" onmouseover="this.style.borderColor='var(--border-gray-700)'" onmouseout="this.style.borderColor='var(--border-gray-800)'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="21" x2="4" y2="14"></line>
            <line x1="4" y1="10" x2="4" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12" y2="3"></line>
            <line x1="20" y1="21" x2="20" y2="16"></line>
            <line x1="20" y1="12" x2="20" y2="3"></line>
            <line x1="1" y1="14" x2="7" y2="14"></line>
            <line x1="9" y1="8" x2="15" y2="8"></line>
            <line x1="17" y1="16" x2="23" y2="16"></line>
          </svg>
          <span>{% trans "Filters" %}</span>
        </button>
      </div>
      
      {# Active filters badges #}
      {% if search_query or selected_category or selected_tag or selected_sort != '-uploaded_at' %}
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem;">
          {% if search_query %}
            <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; background: var(--bg-gray-900); border: 1px solid var(--border-gray-800); border-radius: var(--radius-full); color: var(--text-gray-300); font-size: 0.8125rem;">
              <span>{% trans "Search:" %} "{{ search_query }}"</span>
            </span>
          {% endif %}
          {% if selected_category %}
            <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; background: var(--bg-gray-900); border: 1px solid var(--border-gray-800); border-radius: var(--radius-full); color: var(--text-gray-300); font-size: 0.8125rem;">
              <span>{% trans "Category:" %} {{ selected_category }}</span>
            </span>
          {% endif %}
          {% if selected_tag %}
            <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; background: var(--bg-gray-900); border: 1px solid var(--border-gray-800); border-radius: var(--radius-full); color: var(--text-gray-300); font-size: 0.8125rem;">
              <span>{% trans "Tag:" %} {{ selected_tag }}</span>
            </span>
          {% endif %}
          <a href="{% url 'core:explore' %}" style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.375rem 0.75rem; background: transparent; border: 1px solid var(--border-gray-800); border-radius: var(--radius-full); color: var(--text-gray-400); font-size: 0.8125rem; cursor: pointer; text-decoration: none; transition: var(--transition);" onmouseover="this.style.borderColor='var(--border-gray-700)'; this.style.color='var(--text-white)'" onmouseout="this.style.borderColor='var(--border-gray-800)'; this.style.color='var(--text-gray-400)'">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            <span>{% trans "Clear all" %}</span>
          </a>
        </div>
      {% endif %}
    </div>
  </section>

  {# Grid de SVGs #}
  <section style="padding: 2rem 0 4rem;">
    <div class="container">
      <!-- Loading indicator para HTMX -->
      <div id="loading-indicator" class="htmx-indicator" style="display: none; text-align: center; padding: 2rem; color: var(--text-gray-400);">
        <div style="display: inline-block; animation: spin 1s linear infinite;">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="2" x2="12" y2="6"></line>
            <line x1="12" y1="18" x2="12" y2="22"></line>
            <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
            <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
            <line x1="2" y1="12" x2="6" y2="12"></line>
            <line x1="18" y1="12" x2="22" y2="12"></line>
            <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
            <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
          </svg>
        </div>
        <p style="margin-top: 0.5rem;">{% trans "Loading..." %}</p>
      </div>
      
      <div id="svgGrid">
        {% include 'core/partials/explore_grid.html' %}
      </div>
    </div>
  </section>
</div>

<style>
  @media (max-width: 1023px) {
    #mainContent {
      margin-left: 0 !important;
    }
    .mobile-filter-btn {
      display: flex !important;
    }
  }
  
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  .htmx-indicator {
    opacity: 0;
    transition: opacity 200ms ease-in;
  }
  
  .htmx-request .htmx-indicator {
    opacity: 1;
    display: block !important;
  }
  
  .htmx-request.htmx-indicator {
    opacity: 1;
    display: block !important;
  }
</style>

<script>
  function toggleSidebar() {
    const sidebar = document.getElementById('filterSidebar');
    const overlay = document.getElementById('sidebarOverlay');
    
    sidebar.classList.toggle('active');
    
    if (sidebar.classList.contains('active')) {
      overlay.style.display = 'block';
    } else {
      overlay.style.display = 'none';
    }
  }
</script>
{% endblock %}
